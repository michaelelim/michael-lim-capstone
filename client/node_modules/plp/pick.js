'use strict';

const _ = {
  each: require('./each'),
  nameValuePair: require('./name-value-pair'),
  keys: require('./keys'),
};

function pick (data = {}, predicate = [], bindMethods = false) {
  var result = {},
    names = typeof predicate === 'function'
      ? _
        .keys(data)
        .filter(key => !!predicate(data[key], key, data))
      : predicate;
  _.each(names, name => {
    var val = data[name];
    if (typeof bindMethods === 'function') {
      let mod = _.nameValuePair(bindMethods(val, name));
      name = mod.name;
      val = mod.value;
    } else if (bindMethods && typeof val === 'function')
      val = val.bind(data);
    result[name] = val;
    if (!data.hasOwnProperty(name)) return;
    delete data[name];
  });
  return result;
}

module.exports = pick;
