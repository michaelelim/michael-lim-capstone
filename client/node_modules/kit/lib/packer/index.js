'use strict';

const _ = require('lodash');
const Pack = require('./pack');
const fs = require('fs');
const path = require('path');
const os = require('os');

const minifier = require('./minifier');

const tmpdir = path.join(os.tmpdir(), 'kit-builder');

try {
  fs.mkdirSync(tmpdir);
} catch(err) {}

module.exports = {

  Pack: Pack,
  minifier,

  packFile (filename, opts = {}) {
    var self = this;
    opts.entry = opts.entry || filename;
    opts.context = opts.context || path.dirname(filename);
    opts.output = opts.output || {};
    opts.output.path = opts.output.path || tmpdir;
    opts.output.filename = opts.output.filename || `${Date.now()}-${Math.floor(Math.random() * 1000000)}.js`;
    return (new Pack(opts)).run();
  },

  watchFile (filename, opts = {}) {
    var self = this,
      options = opts,
      pack = new Pack(options);
    return pack.watch();
  },

};
