'use strict';

const _ = {
  extend: require('./extend'),
  defaults: require('./defaults'),
  expression: require('./expression'),
  regFromString: require('./reg-from-string'),
};

function template(source = '', o = {}) {
  var opts = _.defaults(o, {
      expression: `[[...]]`,
      localsAs: null,
    }),
    re = _.regFromString(opts.expression, 'mgi', {
      groupsNames: ['expr'],
    });
  _.extend(template, {
    source: source,
    opts: opts,
    re: re,
  });
  return template;
  function template(locs = {}) {
    var locals = opts.localsAs ? {
      [opts.localsAs]: locs,
    } : locs;
    return re.replace(source, (data) => _.expression(data.params.expr, locals));
  };
}

module.exports = template;
