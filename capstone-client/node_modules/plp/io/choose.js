'use strict';

const FileItem = require('./file-item.class');

const _ = {
  extend: require('../extend'),
  uniqueId: require('../unique-id'),
  create: require('../create'),

  files: require('./files'),
};

function choose(multiple = false) {
  var uid = _.uniqueId('filekit-input-'),
    elem = _.create({
      tag: 'input',
      appendTo: 'body',
      css: {
        display: 'none',
      },
      attrs: {
        type: 'file',
        id: uid,
      },
      props: {
        multiple: !!multiple,
      },
    });
  return new Promise((resolve, reject) => {
    elem.onchange = (ev) => {
      var files = _.files.fromInput(elem);
      elem.remove();
      resolve(multiple ? files : files[0]);
    };
    elem.click();
  });
}

function chooseSingleFile() {
  return choose(false);
}

function chooseMultipleFiles() {
  return choose(true);
}

_.extend(choose, {
  one: chooseSingleFile,
  many: chooseMultipleFiles,
});

module.exports = choose;
